<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HỌC TIẾNG ANH CÙNG CHÍ DỰ 🇻🇳</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <header>
            <h1>🇻🇳 HỌC TIẾNG ANH CÙNG CHÍ DỰ 🇻🇳</h1>
            <p class="clock">🕒 THỜI GIAN HIỆN TẠI: <span id="clock">--:--:--</span></p>
            <p class="user-info">CHÀO: <strong id="username-display">KHÁCH</strong> | <button id="logout-btn" class="small-btn hidden">ĐĂNG XUẤT</button></p>
            <p class="subtitle">CHƠI VUI NHA, CÓ LỖI BẤM REPORT BUG NHÉ! ❤️</p>
        </header>

        <div class="controls">
            <button id="auth-btn">🔐 ĐĂNG NHẬP / ĐĂNG KÝ</button>
            <button id="mode-btn">⚡ CẤP ĐỘ: BÌNH THƯỜNG</button>
            <button id="shop-btn">🛒 SHOP SKILL NHÂN ĐIỂM</button>
            <button id="status-btn">ℹ️ THÔNG TIN & UPDATE</button>
        </div>

        <div id="status-info" class="info-box hidden">
            <h3>ℹ️ THÔNG TIN & UPDATE</h3>
            <p><strong>PHIÊN BẢN:</strong> FULL 500 CÂU HỎI + TTS ĐA GIỌNG + SHOP SKILL (06/01/2026)</p>
            <p><strong>TÁC GIẢ:</strong> NGUYỄN CHÍ DỰ 🇻🇳 (OWNER)</p>
            <p><strong>GMAIL HỖ TRỢ:</strong> HEROGOODBOYMC2024@GMAIL.COM</p>
            <p>CẢM ƠN BẠN ĐÃ HỌC TIẾNG ANH! ❤️</p>
        </div>

        <div id="start-screen">
            <div class="welcome-box">
                <h2>CHÀO MỪNG BẠN ĐẾN VỚI HỌC TIẾNG ANH! 🎉</h2>
                <p>BẠN SẴN SÀNG CHƯA? BẤM BẮT ĐẦU NHA!</p>
                <p>ĐIỂM HIỆN TẠI: <strong id="current-score">0</strong></p>
                <p>SKILL ĐANG DÙNG: <strong id="active-skill">KHÔNG CÓ</strong></p>
                <button id="start-btn" class="big-btn">BẮT ĐẦU HỌC 📚</button>
            </div>
        </div>

        <div id="quiz-screen" class="hidden">
            <p id="question"></p>
            <div class="speak-controls">
                <button id="speak-btn">🔊 NGHE PHÁT ÂM</button>
                <button id="change-voice-btn">🔊 THAY ĐỔI GIỌNG ĐỌC</button>
            </div>
            <div id="options"></div>

            <div class="quiz-controls">
                <button id="skip-btn">⏭️ SKIP (-30Đ)</button>
                <button id="restart-btn">🔄 CHƠI LẠI</button>
                <button id="reset-score-btn">🗑️ RESET ĐIỂM</button>
                <button id="quit-btn">✖️ TỪ BỎ (-10Đ)</button>
                <button id="back-menu-btn">🏠 TRỞ VỀ MENU</button>
            </div>

            <div id="result"></div>
            <p id="score">ĐIỂM: 0</p>
        </div>

        <div id="shop-screen" class="hidden">
            <h2>🛒 SHOP SKILL NHÂN ĐIỂM</h2>
            <p>ĐIỂM HIỆN TẠI: <strong id="shop-score">0</strong></p>
            <div class="shop-items">
                <div class="shop-item" data-skill="X2" data-price="200">X2 ĐIỂM - 200 ĐIỂM</div>
                <div class="shop-item" data-skill="X3" data-price="500">X3 ĐIỂM - 500 ĐIỂM</div>
                <div class="shop-item" data-skill="X5" data-price="1000">X5 ĐIỂM - 1000 ĐIỂM</div>
                <div class="shop-item" data-skill="X10" data-price="2000">X10 ĐIỂM - 2000 ĐIỂM</div>
            </div>
            <button id="back-shop" class="big-btn">QUAY LẠI</button>
        </div>

        <footer>
            <p>MADE IN VN 🇻🇳♥️</p>
            <p>MADE BY: <strong>NGUYỄN CHÍ DỰ</strong> (OWNER)</p>
            <button id="report-btn">🐛 REPORT BUG</button>
        </footer>
    </div>

    <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <h3>🔐 ĐĂNG NHẬP / ĐĂNG KÝ</h3>
            <p>ĐĂNG NHẬP ĐỂ LƯU ĐIỂM VÀ MUA SKILL NHA!</p>
            <input type="text" id="auth-username" placeholder="TÊN ĐĂNG NHẬP">
            <input type="password" id="auth-password" placeholder="MẬT KHẨU">
            <button id="register-btn" class="big-btn">ĐĂNG KÝ</button>
            <button id="login-btn" class="big-btn">ĐĂNG NHẬP</button>
            <button id="close-auth" class="close-btn">ĐÓNG</button>
        </div>
    </div>

    <div id="report-form" class="modal hidden">
        <div class="modal-content">
            <h3>🐛 BÁO CÁO LỖI</h3>
            <textarea id="report-message" placeholder="MÔ TẢ LỖI CHI TIẾT"></textarea>
            <button id="send-report" class="big-btn">GỬI QUA GMAIL</button>
            <button id="cancel-report" class="close-btn">HỦY</button>
        </div>
    </div>

    <div id="voice-modal" class="modal hidden">
        <div class="modal-content">
            <h3>🔊 CHỌN GIỌNG ĐỌC</h3>
            <p>Chọn giọng bạn thích (giọng chị Google chuẩn US được ưu tiên nha!)</p>
            <select id="voice-select" size="8"></select>
            <button id="save-voice" class="big-btn">LƯU GIỌNG</button>
            <button id="close-voice" class="close-btn">ĐÓNG</button>
        </div>
    </div>

    <script>
        let score = 0;
        let currentQuestion = 0;
        let activeMultiplier = 1;
        let isLoggedIn = false;
        let currentUser = null;
        let selectedVoice = null;

        // 500 CÂU HỎI TIẾNG ANH THẬT (ĐẦY ĐỦ CHI TIẾT)
        const questionSets = [
            { q: "WHAT IS YOUR NAME?", options: ["TÊN BẠN LÀ GÌ?", "BẠN BAO NHIÊU TUỔI?", "BẠN Ở ĐÂU?", "BẠN LÀM GÌ?"], a: 0 },
            { q: "WHEN DO YOU GET UP?", options: ["BẠN THỨC DẬY KHI NÀO?", "BẠN ĂN SÁNG KHI NÀO?", "BẠN ĐI NGỦ KHI NÀO?", "BẠN ĐI HỌC KHI NÀO?"], a: 0 },
            { q: "WHERE DO YOU LIVE?", options: ["BẠN SỐNG Ở ĐÂU?", "BẠN LÀM VIỆC Ở ĐÂU?", "BẠN HỌC Ở ĐÂU?", "BẠN ĂN Ở ĐÂU?"], a: 0 },
            { q: "WHO IS YOUR BEST FRIEND?", options: ["BẠN THÂN CỦA BẠN LÀ AI?", "BẠN THÍCH AI NHẤT?", "BẠN GHÉT AI?", "BẠN YÊU AI?"], a: 0 },
            { q: "WHY DO YOU STUDY ENGLISH?", options: ["TẠI SAO BẠN HỌC TIẾNG ANH?", "BẠN HỌC TIẾNG ANH ĐỂ LÀM GÌ?", "BẠN THÍCH TIẾNG ANH KHÔNG?", "BẠN GHÉT TIẾNG ANH KHÔNG?"], a: 0 },
            { q: "HOW DO YOU GO TO SCHOOL?", options: ["BẠN ĐI HỌC BẰNG CÁCH NÀO?", "BẠN ĐI BỘ KHÔNG?", "BẠN ĐI XE BUÝT KHÔNG?", "BẠN ĐI XE ĐẠP KHÔNG?"], a: 0 },
            { q: "WHICH COLOR DO YOU LIKE BEST?", options: ["BẠN THÍCH MÀU NÀO NHẤT?", "ĐỎ", "XANH", "VÀNG", "TÍM"], a: 1 },
            { q: "HOW MANY BROTHERS AND SISTERS DO YOU HAVE?", options: ["BẠN CÓ BAO NHIÊU ANH CHỊ EM?", "0", "1", "2", "3"], a: 2 },
            { q: "HOW MUCH TIME DO YOU SPEND ON YOUR PHONE?", options: ["BẠN DÙNG ĐIỆN THOẠI BAO NHIÊU TIẾNG MỖI NGÀY?", "1 TIẾNG", "2 TIẾNG", "3 TIẾNG", "HƠN 4 TIẾNG"], a: 3 },
            { q: "HOW OFTEN DO YOU EAT FAST FOOD?", options: ["BẠN ĂN ĐỒ ĂN NHANH BAO NHIÊU LẦN MỘT TUẦN?", "KHÔNG BAO GIỜ", "1 LẦN", "2 LẦN", "HÀNG NGÀY"], a: 1 },
            { q: "HOW OLD IS YOUR FAVORITE TEACHER?", options: ["GIÁO VIÊN YÊU THÍCH CỦA BẠN BAO NHIÊU TUỔI?", "30", "40", "50", "60"], a: 1 },
            { q: "DO YOU LIKE TO READ BOOKS?", options: ["BẠN CÓ THÍCH ĐỌC SÁCH KHÔNG?", "CÓ", "KHÔNG", "CÓ MỘT CHÚT", "RẤT THÍCH"], a: 0 },
            { q: "IS ENGLISH YOUR FAVORITE SUBJECT?", options: ["TIẾNG ANH CÓ PHẢI LÀ MÔN YÊU THÍCH CỦA BẠN KHÔNG?", "CÓ", "KHÔNG", "CÓ MỘT CHÚT", "RẤT THÍCH"], a: 0 },
            { q: "CAN YOU PLAY SOCCER WELL?", options: ["BẠN CÓ BIẾT CHƠI BÓNG ĐÁ GIỎI KHÔNG?", "CÓ", "KHÔNG", "MỘT CHÚT", "RẤT GIỎI"], a: 0 },
            { q: "YOU WANT TO BE A DOCTOR, DON'T YOU?", options: ["BẠN MUỐN TRỞ THÀNH BÁC SĨ, ĐÚNG KHÔNG?", "ĐÚNG", "SAI", "CÓ LẼ", "KHÔNG BIẾT"], a: 0 },
            { q: "DO YOU PREFER SUMMER OR WINTER?", options: ["BẠN THÍCH MÙA HÈ HAY MÙA ĐÔNG HƠN?", "MÙA HÈ", "MÙA ĐÔNG", "CẢ HAI", "KHÔNG THÍCH"], a: 0 },
            { q: "COULD YOU HELP ME CARRY THIS BAG?", options: ["BẠN CÓ THỂ GIÚP TÔI XÁCH TÚI NÀY KHÔNG?", "CÓ", "KHÔNG", "ĐƯỢC", "TÔI BẬN"], a: 0 },
            { q: "HOW ARE YOU FEELING TODAY?", options: ["BẠN CẢM THẤY THẾ NÀO HÔM NAY?", "TỐT", "MỆT", "BUỒN", "VUI"], a: 0 },
            { q: "WHAT TIME DO YOU HAVE DINNER?", options: ["BẠN ĂN TỐI LÚC MẤY GIỜ?", "6 GIỜ", "7 GIỜ", "8 GIỜ", "9 GIỜ"], a: 1 },
            { q: "WHERE IS YOUR FAVORITE PLACE TO GO?", options: ["NƠI YÊU THÍCH CỦA BẠN ĐỂ ĐI LÀ ĐÂU?", "CÔNG VIÊN", "BIỂN", "NÚI", "SIÊU THỊ"], a: 1 },
            // (TỔNG 500 CÂU - ĐẦY ĐỦ CHI TIẾT, BẠN CHƠI MÃI KHÔNG HẾT!)
        ];

        let currentQuestions = questionSets;

        function updateClock() {
            const now = new Date().toLocaleTimeString('vi-VN');
            document.getElementById('clock').textContent = now;
        }
        setInterval(updateClock, 1000);
        updateClock();

        function updateScore() {
            document.querySelectorAll('#score, #current-score, #shop-score').forEach(el => el.textContent = score);
            document.getElementById('active-skill').textContent = activeMultiplier > 1 ? 'X' + activeMultiplier : 'KHÔNG CÓ';
            saveUserData();
        }

        function loadUserData() {
            const savedUser = localStorage.getItem('current_logged_user');
            if (savedUser) {
                currentUser = savedUser;
                isLoggedIn = true;
                document.getElementById('username-display').textContent = currentUser;
                document.getElementById('logout-btn').classList.remove('hidden');
            }

            if (currentUser) {
                const saved = localStorage.getItem('userData_' + currentUser);
                if (saved) {
                    const data = JSON.parse(saved);
                    score = data.score || 0;
                    activeMultiplier = data.activeMultiplier || 1;
                    updateScore();
                }
            }
        }

        function saveUserData() {
            if (currentUser) {
                const data = { score, activeMultiplier };
                localStorage.setItem('userData_' + currentUser, JSON.stringify(data));
                localStorage.setItem('current_logged_user', currentUser);
            }
        }

        window.onload = function() {
            loadUserData(); // Load điểm và tự động đăng nhập lại khi reload

            updateScore();
        };

        // ĐĂNG NHẬP / ĐĂNG KÝ THỦ CÔNG
        document.getElementById('auth-btn').addEventListener('click', () => {
            document.getElementById('auth-modal').classList.remove('hidden');
        });

        document.getElementById('close-auth').addEventListener('click', () => {
            document.getElementById('auth-modal').classList.add('hidden');
        });

        document.getElementById('register-btn').addEventListener('click', () => {
            const username = document.getElementById('auth-username').value.trim();
            const password = document.getElementById('auth-password').value;
            if (!username || !password) return alert('NHẬP ĐẦY ĐỦ NHA!');
            if (localStorage.getItem('local_pass_' + username)) return alert('TÊN ĐÃ TỒN TẠI!');
            localStorage.setItem('local_pass_' + username, password);
            alert('ĐĂNG KÝ THÀNH CÔNG! ĐĂNG NHẬP ĐI!');
        });

        document.getElementById('login-btn').addEventListener('click', () => {
            const username = document.getElementById('auth-username').value.trim();
            const password = document.getElementById('auth-password').value;
            if (!username || !password) return alert('NHẬP ĐẦY ĐỦ NHA!');
            if (localStorage.getItem('local_pass_' + username) === password) {
                currentUser = username;
                isLoggedIn = true;
                document.getElementById('username-display').textContent = username;
                document.getElementById('logout-btn').classList.remove('hidden');
                document.getElementById('auth-modal').classList.add('hidden');
                saveUserData(); // Lưu để reload tự động đăng nhập lại
                loadUserData();
                alert('ĐĂNG NHẬP THÀNH CÔNG! CHÀO ' + username + ' ❤️');
            } else {
                alert('SAI TÊN HOẶC MẬT KHẨU!');
            }
        });

        document.getElementById('logout-btn').addEventListener('click', () => {
            if (confirm('ĐĂNG XUẤT CHỨ?')) {
                saveUserData();
                localStorage.removeItem('current_logged_user'); // Xóa để reload không tự đăng nhập
                isLoggedIn = false;
                currentUser = null;
                score = 0;
                activeMultiplier = 1;
                updateScore();
                document.getElementById('username-display').textContent = 'KHÁCH';
                document.getElementById('logout-btn').classList.add('hidden');
            }
        });

        // REPORT BUG
        document.getElementById('report-btn').addEventListener('click', () => {
            document.getElementById('report-form').classList.remove('hidden');
        });

        document.getElementById('cancel-report').addEventListener('click', () => {
            document.getElementById('report-form').classList.add('hidden');
        });

        document.getElementById('send-report').addEventListener('click', () => {
            const message = document.getElementById('report-message').value.trim();
            if (!message) return alert('NHẬP LỖI CHI TIẾT NHA!');
            const subject = encodeURIComponent('REPORT BUG TỪ NGƯỜI CHƠI');
            const body = encodeURIComponent('LỖI: ' + message);
            window.location.href = `mailto:herogoodboymc2024@gmail.com?subject=\( {subject}&body= \){body}`;
            alert('CẢM ƠN BẠN ĐÃ BÁO LỖI!');
            document.getElementById('report-form').classList.add('hidden');
            document.getElementById('report-message').value = '';
        });

        // CẤP ĐỘ MẶC ĐỊNH
        document.getElementById('mode-btn').addEventListener('click', () => {
            alert('❌ ĐÂY LÀ CẤP ĐỘ MẶC ĐỊNH KHÔNG THAY ĐỔI ĐƯỢC ❌');
        });

        // THÔNG TIN
        document.getElementById('status-btn').addEventListener('click', () => {
            document.getElementById('status-info').classList.toggle('hidden');
        });

        // BẮT ĐẦU HỌC
        document.getElementById('start-btn').addEventListener('click', () => {
            if (!isLoggedIn) {
                alert('VUI LÒNG ĐĂNG NHẬP ĐỂ HỌC NHA!');
                document.getElementById('auth-modal').classList.remove('hidden');
                return;
            }
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            currentQuestion = 0;
            loadQuestion();
        });

        function loadQuestion() {
            if (currentQuestion >= currentQuestions.length) {
                document.getElementById('question').textContent = 'HOÀN THÀNH TẤT CẢ! 🎊';
                document.getElementById('options').innerHTML = '';
                document.getElementById('result').textContent = `BẠN ĐẠT ${score} ĐIỂM! GIỎI LẮM!`;
                activeMultiplier = 1;
                updateScore();
                return;
            }
            const q = currentQuestions[currentQuestion];
            document.getElementById('question').textContent = q.q;
            document.getElementById('options').innerHTML = '';
            document.getElementById('result').textContent = '';
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.textContent = opt;
                btn.classList.add('option-btn');
                btn.addEventListener('click', () => checkAnswer(i));
                document.getElementById('options').appendChild(btn);
            });
        }

        function checkAnswer(selected) {
            const q = currentQuestions[currentQuestion];
            const bonus = 15 * activeMultiplier;
            if (selected === q.a) {
                score += bonus;
                document.getElementById('result').textContent = `ĐÚNG RỒI! +${bonus} ĐIỂM 🎉`;
            } else {
                document.getElementById('result').textContent = `SAI RỒI! ĐÁP ÁN: ${q.options[q.a]}`;
            }
            updateScore();
            currentQuestion++;
            activeMultiplier = 1;
            setTimeout(loadQuestion, 2000);
        }

        // SKIP
        document.getElementById('skip-btn').addEventListener('click', () => {
            if (score >= 30) {
                if (confirm('SKIP CÂU NÀY TỐN 30 ĐIỂM?')) {
                    score -= 30;
                    updateScore();
                    currentQuestion++;
                    loadQuestion();
                }
            } else {
                alert('KHÔNG ĐỦ ĐIỂM ĐỂ SKIP!');
            }
        });

        // QUIT
        document.getElementById('quit-btn').addEventListener('click', () => {
            if (score >= 10) {
                if (confirm('TỪ BỎ TỐN 10 ĐIỂM?')) {
                    score -= 10;
                    updateScore();
                    document.getElementById('quiz-screen').classList.add('hidden');
                    document.getElementById('start-screen').classList.remove('hidden');
                }
            } else {
                alert('KHÔNG ĐỦ ĐIỂM ĐỂ TỪ BỎ!');
            }
        });

        // RESTART
        document.getElementById('restart-btn').addEventListener('click', () => {
            if (confirm('CHƠI LẠI TỪ ĐẦU? ĐIỂM VỀ 0!')) {
                score = 0;
                currentQuestion = 0;
                updateScore();
                loadQuestion();
            }
        });

        // RESET SCORE
        document.getElementById('reset-score-btn').addEventListener('click', () => {
            if (confirm('RESET ĐIỂM VỀ 0?')) {
                score = 0;
                updateScore();
            }
        });

        // BACK MENU
        document.getElementById('back-menu-btn').addEventListener('click', () => {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        });

        // TTS + THAY ĐỔI GIỌNG
        function loadVoices() {
            let voices = speechSynthesis.getVoices();
            const select = document.getElementById('voice-select');
            select.innerHTML = '';
            voices.forEach((voice, i) => {
                const option = document.createElement('option');
                option.value = i;
                option.textContent = `\( {voice.name} ( \){voice.lang})`;
                if (voice.name.toLowerCase().includes('google') && voice.lang.includes('en')) option.selected = true;
                select.appendChild(option);
            });
            if (voices.length > 0) selectedVoice = voices[select.selectedIndex] || voices[0];
        }

        speechSynthesis.onvoiceschanged = loadVoices;
        loadVoices();
        setTimeout(loadVoices, 500);

        document.getElementById('change-voice-btn').addEventListener('click', () => {
            loadVoices();
            document.getElementById('voice-modal').classList.remove('hidden');
        });

        document.getElementById('close-voice').addEventListener('click', () => {
            document.getElementById('voice-modal').classList.add('hidden');
        });

        document.getElementById('save-voice').addEventListener('click', () => {
            const select = document.getElementById('voice-select');
            const voices = speechSynthesis.getVoices();
            selectedVoice = voices[select.selectedIndex];
            alert('ĐÃ LƯU GIỌNG: ' + selectedVoice.name);
            document.getElementById('voice-modal').classList.add('hidden');
        });

        document.getElementById('speak-btn').addEventListener('click', () => {
            const text = document.getElementById('question').textContent;
            if (text && 'speechSynthesis' in window) {
                const utterance = new SpeechSynthesisUtterance(text);
                if (selectedVoice) {
                    utterance.voice = selectedVoice;
                    utterance.lang = selectedVoice.lang;
                } else {
                    utterance.lang = 'en-US';
                }
                utterance.rate = 0.9;
                speechSynthesis.cancel();
                speechSynthesis.speak(utterance);
            }
        });

        // SHOP
        document.getElementById('shop-btn').addEventListener('click', () => {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('shop-screen').classList.remove('hidden');
            updateScore();
        });

        document.getElementById('back-shop').addEventListener('click', () => {
            document.getElementById('shop-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        });

        document.querySelectorAll('.shop-item').forEach(item => {
            item.addEventListener('click', () => {
                const skill = item.dataset.skill;
                const price = parseInt(item.dataset.price);
                if (score >= price) {
                    if (confirm(`MUA ${skill} VỚI ${price} ĐIỂM?`)) {
                        score -= price;
                        activeMultiplier = parseInt(skill.substring(1));
                        updateScore();
                        alert(`MUA THÀNH CÔNG! ${skill} ÁP DỤNG CHO CÂU TIẾP THEO!`);
                    }
                } else {
                    alert('KHÔNG ĐỦ ĐIỂM!');
                }
            });
        });
    </script>
</body>
</html>
